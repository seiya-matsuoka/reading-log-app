INSERT INTO reading_logs (book_id, user_id, date_jst, cumulative_pages, minutes, memo)
VALUES
  ---------------------------------------------------------------------------
  -- demo-1 : books 1〜7
  ---------------------------------------------------------------------------
  -- book_id 1 / 独習JavaScript
  (1, 'demo-1', '2025-01-10', 200, 70, NULL),
  (1, 'demo-1', '2025-01-18', 310, 55, 'DOM 操作の章に突入。'),

  -- book_id 2 / 改訂3版 JavaScript本格入門 / done
  (2, 'demo-1', '2025-02-02',  60, 30, '第1章〜2章のJavaScript基礎文法を読了。'),
  (2, 'demo-1', '2025-02-09', 180, 50, NULL),
  (2, 'demo-1', '2025-02-16', 376, 65, '関数とスコープの章を読み進めた。'),
  (2, 'demo-1', '2025-02-18', 520, 60, NULL),
  (2, 'demo-1', '2025-02-24', 624, 55, 'DOM 操作と非同期処理まで読み終え、1周目を完走。'),

  -- book_id 3 / 現場で使えるTypeScript 詳解実践ガイド

  -- book_id 4 / プロを目指す人のためのTypeScript入門
  (4, 'demo-1', '2025-03-05',  50, 25, NULL),
  (4, 'demo-1', '2025-03-12', 140, 35, '基本的な考え方を一通り確認。'),
  (4, 'demo-1', '2025-03-20', 230, 40, 'オブジェクトについて重点的に学習。'),

  -- book_id 5 / モダンJavaScriptの基本から始める React実践の教科書 / done
  (5, 'demo-1', '2025-03-10',  40, 20, NULL),
  (5, 'demo-1', '2025-03-25', 180, 35, 'React コンポーネントの分割と props / state の違いを理解。'),
  (5, 'demo-1', '2025-04-02', 272, 40, NULL),

  -- book_id 6 / 改訂新版 これからはじめるReact実践入門
  (6, 'demo-1', '2025-02-03',  50, 25, '状態管理のイントロを読んだ。'),
  (6, 'demo-1', '2025-02-19', 210, 80, 'コンポーネント分割の例を読み進めた。'),

  -- book_id 7 / TypeScriptとReact/Next.jsでつくる 実践Webアプリケーション開発

  ---------------------------------------------------------------------------
  -- demo-2 : books 8〜11
  ---------------------------------------------------------------------------
  -- book_id 8 / スッキリわかるJava入門 第4版
  (8, 'demo-2', '2025-03-01',  60, 25, '導入部分をざっと読んだ。'),
  (8, 'demo-2', '2025-03-09', 150, 35, 'クラスとオブジェクトの復習。'),
  (8, 'demo-2', '2025-03-18', 230, 40, NULL),

  -- book_id 9 / スッキリわかるJava入門 実践編 第4版
  (9, 'demo-2', '2025-03-05',  70, 30, '例外処理とコレクションまで読了。'),
  (9, 'demo-2', '2025-03-14', 160, 35, 'ユニットテストの書き方を確認。'),

  -- book_id 10 / リーダブルコード
  (10, 'demo-2', '2025-04-10',  90, 25, NULL),

  -- book_id 11 / プロになるJava

  ---------------------------------------------------------------------------
  -- demo-3 : books 12〜17
  ---------------------------------------------------------------------------
  -- book_id 12 / Webを支える技術 HTTP,URI,HTML,そしてREST
  (12, 'demo-3', '2025-01-16', 140, 70, NULL),
  (12, 'demo-3', '2025-01-25', 210, 35, '基本的な考え方を一通り確認。'),

  -- book_id 13 / 達人プログラマー（第2版）

  -- book_id 14 / ネットワークはなぜつながるのか 第2版

  -- book_id 15 / 達人に学ぶDB設計徹底指南書 第2版
  (15, 'demo-3', '2025-03-08',  50, 25, 'リレーショナルデータベースの概念を学習。'),
  (15, 'demo-3', '2025-03-24', 200, 35, NULL),
  (15, 'demo-3', '2025-04-03', 260, 40, NULL),

  -- book_id 16 / 達人に学ぶSQL徹底指南書 第2版 / done
  (16, 'demo-3', '2025-01-04',  60, 30, 'GROUP BY と集約関数の基本。HAVING 句の使い方を復習。'),
  (16, 'demo-3', '2025-01-11', 140, 35, NULL),
  (16, 'demo-3', '2025-01-19', 267, 40, 'ウィンドウ関数の章。'),
  (16, 'demo-3', '2025-01-27', 368, 45, NULL),

  -- book_id 17 / 新しいLinuxの教科書 第2版
  (17, 'demo-3', '2025-02-03',  70, 30, '環境構築の章を一通り読んだ。'),

  ---------------------------------------------------------------------------
  -- demo-readonly : books 18〜20
  ---------------------------------------------------------------------------
  -- book_id 18 / SQL 第2版 ゼロからはじめるデータベース操作 / done
  (18, 'demo-readonly', '2025-03-06',  70, 40, NULL),
  (18, 'demo-readonly', '2025-03-15', 168, 85, '基本的な SELECT 文を学習。'),
  (18, 'demo-readonly', '2025-04-01', 336, 35, NULL),

  -- book_id 19 / プログラムはなぜ動くのか 第3版
  (19, 'demo-readonly', '2025-03-07',  50, 25, '興味がある章を拾い読み。'),
  (19, 'demo-readonly', '2025-03-17', 120, 30, NULL);

  -- book_id 20 / プリンシプル オブ プログラミング


-- 読書ログから books の集計値（pages_read / minutes_total / state）を再計算
WITH agg AS (
  SELECT
    book_id,
    MAX(cumulative_pages) AS last_pages,
    SUM(minutes) AS total_minutes
  FROM
    reading_logs
  GROUP BY
    book_id
)
UPDATE
  books AS b
SET
  pages_read = a.last_pages,
  minutes_total = a.total_minutes,
  state = CASE
    WHEN a.last_pages >= b.total_pages THEN 'done'
    ELSE 'reading'
  END,
  updated_at = NOW()
FROM
  agg AS a
WHERE
  b.id = a.book_id;